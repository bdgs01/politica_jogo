<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rep√∫blica Digital - Simulador Pol√≠tico</title>
    <!-- jsPDF para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* === RESET E BASE === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --text: #ecf0f1;
            --text-secondary: #bdc3c7;
            --bg-gradient: linear-gradient(135deg, #0c1426 0%, #1e3c72 100%);
            --shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
        }

        /* === CONTAINERS === */
        .app {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            padding: 15px 20px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .title {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent);
        }

        .subtitle {
            font-size: 12px;
            opacity: 0.7;
            margin-left: 10px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .icon-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text);
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* === TELAS === */
        .screen {
            display: none;
            animation: slideIn 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .screen.active {
            display: block;
        }

        /* === COMPONENTES MINIMALISTAS === */
        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .card h3 {
            text-align: center;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text);
            font-size: 16px;
            margin-bottom: 10px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52,152,219,0.3);
        }

        .ideology-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .ideology-btn {
            padding: 15px 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 14px;
        }

        .ideology-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .ideology-btn.selected {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(52,152,219,0.4);
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover:not(:disabled) {
            background: #4aa3df;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:disabled {
            background: var(--secondary);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.secondary {
            background: var(--secondary);
            width: auto;
            padding: 10px 20px;
            margin: 5px;
        }

        /* === STATS MINIMALISTAS === */
        .stats-compact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 10px 5px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            border-left: 3px solid var(--accent);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 3px;
        }

        /* === SISTEMA DE RECURSOS/A√á√ïES === */
        .resources-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .resource { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }

        .actions-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .action-card:hover:not(.disabled) {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.3);
        }

        .action-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: transparent;
        }

        .action-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-cost {
            font-size: 12px;
            color: var(--warning);
            background: rgba(243,156,18,0.2);
            padding: 3px 10px;
            border-radius: 12px;
        }

        .action-description {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .action-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 11px;
        }

        .effect { 
            padding: 2px 8px; 
            border-radius: 10px; 
            background: rgba(255,255,255,0.1); 
        }
        .effect.positive { color: var(--success); }
        .effect.negative { color: var(--danger); }

        /* === MODAL === */
        .modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: var(--primary);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: scaleUp 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .modal-title { 
            font-size: 20px; 
            font-weight: 600; 
            margin-bottom: 15px; 
            text-align: center; 
        }
        .modal-text { 
            font-size: 14px; 
            line-height: 1.6; 
            margin-bottom: 20px; 
            opacity: 0.9; 
        }
        #modal-choices { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }

        .philosophy-quote {
            font-style: italic;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-left: 3px solid var(--accent);
            margin: 20px 0;
            font-size: 13px;
            line-height: 1.5;
            border-radius: 4px;
        }

        /* === PROGRESS BARS === */
        .progress-container { margin: 20px 0; }
        .progress-label { 
            display: flex; 
            justify-content: space-between; 
            font-size: 12px; 
            margin-bottom: 8px; 
        }
        .progress-bar { 
            height: 8px; 
            background: rgba(0,0,0,0.3); 
            border-radius: 4px; 
            overflow: hidden; 
        }
        .progress-fill { 
            height: 100%; 
            transition: width 0.4s ease; 
            border-radius: 4px; 
        }
        #popularity-bar { 
            background: linear-gradient(90deg, var(--accent), #8e44ad); 
        }
        #impeachment-bar { 
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger)); 
        }

        /* === NOTIFICA√á√ïES === */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }

        /* === RESPONSIVE & ANIMATIONS === */
        @media (max-width: 480px) {
            .ideology-grid { grid-template-columns: 1fr; }
            .stats-compact { grid-template-columns: repeat(2, 1fr); }
            .main-content { padding: 15px; }
            .header-controls { display: none; }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div>
                <span class="title">üìä Rep√∫blica Digital</span>
                <span class="subtitle" id="header-subtitle">Simulador Pol√≠tico</span>
            </div>
            <div class="header-controls">
                <button class="icon-btn" id="save-btn" title="Salvar Jogo" onclick="game && game.saveGame()">üíæ</button>
                <button class="icon-btn" id="load-btn" title="Carregar Jogo" onclick="game && game.loadGame()">üìÅ</button>
                <button class="icon-btn" id="export-btn" title="Exportar PDF" onclick="game && game.exportToPDF()">üìÑ</button>
                <div id="term-display" style="font-size: 14px; font-weight: 600;"></div>
            </div>
        </div>

        <div class="main-content">
            <!-- TELA DE CRIA√á√ÉO -->
            <div id="setup" class="screen active">
                <div class="card">
                    <h3>Configura√ß√£o do Candidato</h3>
                    <input type="text" id="candidate-name" class="input-field" placeholder="Nome do candidato" maxlength="50">
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px;">Orienta√ß√£o Pol√≠tica:</label>
                        <div class="ideology-grid">
                            <div class="ideology-btn" data-ideology="esquerda">
                                <div>üåπ Esquerda</div>
                                <div style="font-size: 10px; opacity: 0.8;">Igualdade</div>
                            </div>
                            <div class="ideology-btn" data-ideology="centro">
                                <div>‚öñÔ∏è Centro</div>
                                <div style="font-size: 10px; opacity: 0.8;">Equil√≠brio</div>
                            </div>
                            <div class="ideology-btn" data-ideology="direita">
                                <div>üíº Direita</div>
                                <div style="font-size: 10px; opacity: 0.8;">Liberdade</div>
                            </div>
                        </div>
                    </div>

                    <div id="philosophy-preview" class="philosophy-quote" style="display: none;"></div>
                    
                    <button id="start-game" class="btn" disabled>Iniciar Campanha</button>
                    
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn secondary" onclick="game && game.loadGame()">Continuar Jogo Salvo</button>
                    </div>
                </div>
            </div>

            <!-- TELA DE CAMPANHA -->
            <div id="campaign" class="screen">
                <div class="resources-bar">
                    <div class="resource">‚è∞ <span id="days-left">90</span> dias</div>
                    <div class="resource">üí∞ R$<span id="funds">50</span>M</div>
                    <div class="resource">ü§ù <span id="support">0</span>% Apoio</div>
                </div>
                <div class="stats-compact" id="campaign-stats"></div>
                <div class="actions-list" id="campaign-actions"></div>
            </div>

            <!-- TELA DE GOVERNO -->
            <div id="government" class="screen">
                <div class="resources-bar">
                    <div class="resource">üóìÔ∏è <span id="months-left">48</span> meses</div>
                </div>
                <div class="stats-compact" id="government-stats"></div>
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Aprova√ß√£o Popular</span>
                        <span id="popularity-percent">60%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="popularity-bar" style="width: 60%"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Risco de Impeachment</span>
                        <span id="impeachment-percent">15%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="impeachment-bar" style="width: 15%"></div>
                    </div>
                </div>
                <div class="actions-list" id="government-actions"></div>
            </div>
        </div>

        <!-- MODAL -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <h3 id="modal-title" class="modal-title"></h3>
                <div id="modal-body" class="modal-text"></div>
                <div id="modal-choices"></div>
            </div>
        </div>
    </div>

    <script>
        class RepublicaDigital {
            constructor() {
                // Sistema de IA e intelig√™ncia avan√ßada
                this.aiSystem = {
                    adaptiveDifficulty: 1.0,
                    playerBehaviorPattern: { aggressive: 0, conservative: 0, populist: 0 },
                    contextualEvents: [],
                    politicalTrends: {}
                };
                
                // Cache de elementos DOM
                this.dom = {};
                this.initDOMCache();

                this.gameHistory = {
                    actions: [],
                    events: [],
                    decisions: [],
                    performance: {}
                };

                this.philosophyTexts = this.initPhilosophyTexts();
                this.init();
            }

            initDOMCache() {
                this.dom = {
                    screens: document.querySelectorAll('.screen'),
                    modal: document.getElementById('modal'),
                    modalTitle: document.getElementById('modal-title'),
                    modalBody: document.getElementById('modal-body'),
                    modalChoices: document.getElementById('modal-choices'),
                    headerSubtitle: document.getElementById('header-subtitle'),
                    termDisplay: document.getElementById('term-display'),
                    candidateNameInput: document.getElementById('candidate-name'),
                    ideologyBtns: document.querySelectorAll('.ideology-btn'),
                    philosophyPreview: document.getElementById('philosophy-preview'),
                    startGameBtn: document.getElementById('start-game'),
                };
            }

            // === INICIALIZA√á√ÉO ===
            init() {
                // Limpa timers existentes
                Object.values(this.timers || {}).forEach(timer => clearInterval(timer));
                
                this.player = this.getInitialPlayerState();
                this.gameState = 'setup';
                this.timers = { campaign: null, government: null };
                
                this.setupEventListeners();
                this.resetUI();
                this.updateUI();
                this.showScreen('setup');
                this.autoSaveInterval();
            }

            getInitialPlayerState() {
                return {
                    name: '', 
                    ideology: '', 
                    term: 1, 
                    maxTerms: 2,
                    startTime: Date.now(),
                    stats: {
                        days: 90, funds: 50, support: 0, approval: 45, 
                        coalitions: 2, mediaPresence: 30, debateScore: 0,
                        months: 48, 
                        economy: 50, social: 50, security: 50, 
                        international: 50, environment: 50, democracy: 75,
                        popularity: 60, impeachmentRisk: 15
                    }
                };
            }

            // === SISTEMA DE INTELIG√äNCIA AVAN√áADA ===
            updateAI() {
                // Analisa padr√£o de comportamento do jogador
                const recentActions = this.gameHistory.actions.slice(-5);
                this.aiSystem.playerBehaviorPattern = {
                    aggressive: recentActions.filter(a => a.type === 'aggressive').length,
                    conservative: recentActions.filter(a => a.type === 'conservative').length,
                    populist: recentActions.filter(a => a.type === 'populist').length
                };

                // Ajusta dificuldade dinamicamente
                const performance = this.calculateOverallPerformance();
                if (performance > 75) {
                    this.aiSystem.adaptiveDifficulty = Math.min(2.0, this.aiSystem.adaptiveDifficulty + 0.1);
                } else if (performance < 40) {
                    this.aiSystem.adaptiveDifficulty = Math.max(0.5, this.aiSystem.adaptiveDifficulty - 0.1);
                }
            }

            calculateOverallPerformance() {
                if (this.gameState === 'campaign') {
                    return (this.player.stats.support + this.player.stats.approval) / 2;
                } else {
                    const govStats = ['economy', 'social', 'security', 'international', 'environment'];
                    const avg = govStats.reduce((sum, stat) => sum + this.player.stats[stat], 0) / govStats.length;
                    return avg;
                }
            }

            generateIntelligentEvent() {
                const pattern = this.aiSystem.playerBehaviorPattern;
                const difficulty = this.aiSystem.adaptiveDifficulty;
                
                // Eventos adaptativos baseados no comportamento do jogador
                const contextualEvents = {
                    aggressive: [
                        {
                            title: "Rea√ß√£o Internacional",
                            description: "Suas pol√≠ticas agressivas geram tens√£o diplom√°tica.",
                            choices: [
                                { text: "Manter posi√ß√£o", effects: { international: -10, popularity: 5 } },
                                { text: "Buscar di√°logo", effects: { international: 5, popularity: -3 } }
                            ]
                        }
                    ],
                    conservative: [
                        {
                            title: "Press√£o por Mudan√ßas",
                            description: "Movimentos sociais cobram reformas mais ousadas.",
                            choices: [
                                { text: "Acelerar reformas", effects: { social: 10, economy: -5 } },
                                { text: "Manter gradualismo", effects: { social: -5, democracy: 5 } }
                            ]
                        }
                    ],
                    populist: [
                        {
                            title: "Quest√µes Fiscais",
                            description: "Economistas alertam sobre gastos excessivos.",
                            choices: [
                                { text: "Cortar gastos", effects: { economy: 10, popularity: -15 } },
                                { text: "Manter programas", effects: { economy: -8, popularity: 8 } }
                            ]
                        }
                    ]
                };

                const dominantPattern = Object.keys(pattern).reduce((a, b) => 
                    pattern[a] > pattern[b] ? a : b
                );

                const availableEvents = contextualEvents[dominantPattern] || contextualEvents.conservative;
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                
                // Ajusta intensidade baseada na dificuldade
                if (event && event.choices) {
                    event.choices.forEach(choice => {
                        Object.keys(choice.effects).forEach(stat => {
                            choice.effects[stat] = Math.round(choice.effects[stat] * difficulty);
                        });
                    });
                }

                return event;
            }

            // === SETUP E EVENT LISTENERS ===
            setupEventListeners() {
                // Remove listeners antigos para evitar duplica√ß√£o
                if (this.dom.startGameBtn) {
                    const newStartBtn = this.dom.startGameBtn.cloneNode(true);
                    this.dom.startGameBtn.parentNode.replaceChild(newStartBtn, this.dom.startGameBtn);
                    this.dom.startGameBtn = newStartBtn;
                    this.dom.startGameBtn.addEventListener('click', () => this.startCampaign());
                }

                if (this.dom.candidateNameInput) {
                    this.dom.candidateNameInput.addEventListener('input', (e) => {
                        this.player.name = e.target.value.trim();
                        this.checkSetupComplete();
                    });
                }

                // Reconstroi listeners para bot√µes de ideologia
                this.dom.ideologyBtns.forEach(btn => {
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    newBtn.addEventListener('click', () => {
                        document.querySelectorAll('.ideology-btn').forEach(b => b.classList.remove('selected'));
                        newBtn.classList.add('selected');
                        this.player.ideology = newBtn.dataset.ideology;
                        this.showPhilosophyPreview();
                        this.checkSetupComplete();
                    });
                });

                // Atualiza cache DOM
                this.dom.ideologyBtns = document.querySelectorAll('.ideology-btn');
            }

            resetUI() {
                if (this.dom.candidateNameInput) this.dom.candidateNameInput.value = '';
                this.dom.ideologyBtns.forEach(b => b.classList.remove('selected'));
                if (this.dom.philosophyPreview) this.dom.philosophyPreview.style.display = 'none';
                if (this.dom.startGameBtn) this.dom.startGameBtn.disabled = true;
            }

            initPhilosophyTexts() {
                return {
                    esquerda: "\"Rousseau argumentava que a propriedade privada era fonte de desigualdade e que o Estado deveria representar a vontade geral do povo.\"",
                    centro: "\"John Stuart Mill estabeleceu o princ√≠pio do dano, argumentando que o Estado s√≥ deveria intervir para prevenir danos a outros.\"",
                    direita: "\"Adam Smith estabeleceu os fundamentos do liberalismo econ√¥mico, defendendo que a liberdade individual geraria prosperidade.\""
                };
            }

            showPhilosophyPreview() {
                if (this.dom.philosophyPreview && this.philosophyTexts[this.player.ideology]) {
                    this.dom.philosophyPreview.textContent = this.philosophyTexts[this.player.ideology];
                    this.dom.philosophyPreview.style.display = 'block';
                }
            }

            checkSetupComplete() {
                if (this.dom.startGameBtn) {
                    this.dom.startGameBtn.disabled = !this.player.name || !this.player.ideology;
                }
            }

            // === TRANSI√á√ïES DE ESTADO ===
            transitionToState(newState) {
                this.gameState = newState;
                
                if (this.dom.headerSubtitle) {
                    this.dom.headerSubtitle.textContent = {
                        setup: "Simulador Pol√≠tico",
                        campaign: `Campanha de ${this.player.name}`,
                        government: `Governo ${this.player.name}`
                    }[newState];
                }

                this.showScreen(newState);

                switch(newState) {
                    case 'campaign':
                        this.setupCampaignActions();
                        this.startCampaignTimer();
                        break;
                    case 'government':
                        this.setupGovernmentActions();
                        this.startGovernmentTimer();
                        break;
                }
                this.updateUI();
                this.saveGame(); // Auto-save em transi√ß√µes
            }

            startCampaign() { 
                this.transitionToState('campaign'); 
            }
            
            startGovernment() { 
                this.transitionToState('government'); 
            }

            // === L√ìGICA DE CAMPANHA ===
            setupCampaignActions() {
                const actions = [
                    { 
                        id: 'social_media', 
                        title: 'üì± Campanha Digital', 
                        description: 'Estrat√©gia focada em redes sociais e influenciadores digitais.', 
                        costs: { funds: 8, days: 5 }, 
                        effects: { support: 12, mediaPresence: 15, approval: 8 },
                        type: 'populist',
                        philosophy: "A comunica√ß√£o digital representa a nova √°gora democr√°tica de nosso tempo."
                    },
                    { 
                        id: 'traditional_media', 
                        title: 'üì∫ M√≠dia Tradicional', 
                        description: 'Investimento em TV, r√°dio e jornais estabelecidos.', 
                        costs: { funds: 15, days: 7 }, 
                        effects: { approval: 20, mediaPresence: 25, support: 8 },
                        type: 'conservative',
                        philosophy: "Burke defendia as institui√ß√µes estabelecidas como fonte de legitimidade."
                    },
                    { 
                        id: 'grassroots', 
                        title: 'üö∂ Base Popular', 
                        description: 'Mobiliza√ß√£o direta com com√≠cios e organiza√ß√µes locais.', 
                        costs: { funds: 5, days: 10 }, 
                        effects: { support: 25, coalitions: 1, approval: 15 },
                        type: 'populist',
                        philosophy: "Rousseau acreditava na soberania popular como √∫nica fonte leg√≠tima de poder."
                    },
                    { 
                        id: 'debate_prep', 
                        title: 'üéôÔ∏è Prepara√ß√£o para Debates', 
                        description: 'Treinamento intensivo e assessoria especializada.', 
                        costs: { funds: 10, days: 8 }, 
                        effects: { debateScore: 30, approval: 12, mediaPresence: 10 },
                        type: 'conservative',
                        philosophy: "Mill enfatizava que o debate livre de ideias √© essencial para o progresso."
                    },
                    { 
                        id: 'coalition_building', 
                        title: 'ü§ù Articula√ß√£o Pol√≠tica', 
                        description: 'Negocia√ß√µes com partidos, governadores e lideran√ßas.', 
                        costs: { funds: 20, days: 12 }, 
                        effects: { coalitions: 3, support: 18, approval: 5 },
                        type: 'conservative',
                        philosophy: "Tocqueville destacou a import√¢ncia das institui√ß√µes intermedi√°rias."
                    },
                    { 
                        id: 'attack_ads', 
                        title: '‚öîÔ∏è Campanha Negativa', 
                        description: 'Ataques direcionados aos principais advers√°rios.', 
                        costs: { funds: 12, days: 6 }, 
                        effects: { support: 15, approval: -5, mediaPresence: 20 },
                        type: 'aggressive',
                        philosophy: "Maquiavel argumentava que fins justificam os meios na pol√≠tica."
                    }
                ];

                this.renderActions('campaign-actions', actions, this.executeCampaignAction.bind(this));
            }

            executeCampaignAction(action) {
                if (!this.canAffordAction(action.costs)) {
                    this.showNotification("Recursos insuficientes!");
                    return;
                }

                this.applyCosts(action.costs);
                this.applyEffects(action.effects);
                
                // Registra a√ß√£o no hist√≥rico
                this.gameHistory.actions.push({
                    type: action.type,
                    timestamp: Date.now(),
                    action: action.id,
                    state: 'campaign'
                });

                this.updateAI();
                this.updateUI();
                this.setupCampaignActions();
                
                // Chance de evento inteligente
                if (Math.random() < 0.3) {
                    this.triggerIntelligentEvent();
                }

                if (this.player.stats.days <= 0) {
                    this.endCampaign();
                }
            }

            startCampaignTimer() {
                this.timers.campaign = setInterval(() => {
                    if (this.gameState !== 'campaign') {
                        clearInterval(this.timers.campaign);
                        return;
                    }
                    
                    this.player.stats.days--;
                    if (this.player.stats.days <= 0) {
                        this.endCampaign();
                    }
                    this.updateUI();
                }, 2000);
            }

            endCampaign() {
                clearInterval(this.timers.campaign);
                const finalScore = this.calculateElectionScore();
                
                this.gameHistory.performance.electionScore = finalScore;
                
                if (finalScore >= 60) {
                    this.showModal(
                        "üéâ VIT√ìRIA ELEITORAL!", 
                        `Parab√©ns, ${this.player.name}! Com ${finalScore}% dos votos, voc√™ foi eleito Presidente do Brasil.`, 
                        [{ text: "Assumir Presid√™ncia", callback: () => this.startGovernment() }]
                    );
                } else {
                    this.gameHistory.performance.gameEnded = 'electoral_defeat';
                    this.showModal(
                        "‚ùå DERROTA ELEITORAL", 
                        `Voc√™ obteve ${finalScore}% dos votos. N√£o foi suficiente para vencer a elei√ß√£o.`, 
                        [
                            { text: "Exportar Relat√≥rio", callback: () => this.exportToPDF() },
                            { text: "Novo Jogo", callback: () => this.init() }
                        ]
                    );
                }
            }

            calculateElectionScore() {
                const { support, approval, debateScore, mediaPresence } = this.player.stats;
                const score = (support * 0.4) + (approval * 0.3) + (debateScore * 0.2) + (mediaPresence * 0.1);
                return Math.max(0, Math.round(score));
            }

            // === L√ìGICA DE GOVERNO ===
            setupGovernmentActions() {
                const actions = [
                    { 
                        id: 'economic_reform', 
                        title: 'üí∞ Reforma Tribut√°ria', 
                        description: 'Reestrutura√ß√£o completa do sistema tribut√°rio brasileiro.', 
                        costs: { months: 6 }, 
                        effects: { economy: 15, social: -5, democracy: -3 },
                        type: 'conservative',
                        philosophy: "Smith defendia que impostos deveriam ser proporcionais √† capacidade."
                    },
                    { 
                        id: 'social_program', 
                        title: 'üë• Renda Universal', 
                        description: 'Programa de renda b√°sica universal para todos os brasileiros.', 
                        costs: { months: 8 }, 
                        effects: { social: 25, economy: -10, democracy: 5 },
                        type: 'populist',
                        philosophy: "Rawls: desigualdades s√≥ s√£o justas se beneficiarem os menos favorecidos."
                    },
                    { 
                        id: 'security_op', 
                        title: 'üöî Opera√ß√£o de Seguran√ßa', 
                        description: 'For√ßas federais contra o crime organizado em todo territ√≥rio nacional.', 
                        costs: { months: 4 }, 
                        effects: { security: 20, democracy: -8, social: -5 },
                        type: 'aggressive',
                        philosophy: "Hobbes vs Locke: o eterno dilema entre seguran√ßa e liberdade."
                    },
                    { 
                        id: 'env_policy', 
                        title: 'üå± Pol√≠tica Ambiental', 
                        description: 'Transi√ß√£o energ√©tica e prote√ß√£o radical da Amaz√¥nia.', 
                        costs: { months: 10 }, 
                        effects: { environment: 30, economy: -8, international: 15 },
                        type: 'progressive',
                        philosophy: "Jonas propunha √©tica da responsabilidade para gera√ß√µes futuras."
                    },
                    { 
                        id: 'diplomatic_mission', 
                        title: 'üåç Miss√£o Diplom√°tica', 
                        description: 'Ofensiva diplom√°tica para fortalecer posi√ß√£o internacional do Brasil.', 
                        costs: { months: 5 }, 
                        effects: { international: 20, economy: 5, democracy: 3 },
                        type: 'conservative',
                        philosophy: "Kant vislumbrava uma federa√ß√£o de na√ß√µes livres e pac√≠ficas."
                    },
                    { 
                        id: 'constitutional_reform', 
                        title: 'üìú Reforma Constitucional', 
                        description: 'Mudan√ßas estruturais na Constitui√ß√£o para governabilidade.', 
                        costs: { months: 12 }, 
                        effects: { democracy: -15, economy: 10 },
                        type: 'aggressive',
                        philosophy: "Schmitt alertava sobre os riscos da exce√ß√£o constitucional permanente."
                    }
                ];

                this.renderActions('government-actions', actions, this.executeGovernmentAction.bind(this));
            }

            executeGovernmentAction(action) {
                if (!this.canAffordAction(action.costs)) {
                    this.showNotification("Tempo insuficiente!");
                    return;
                }

                this.applyCosts(action.costs);
                this.applyEffects(action.effects);
                
                // Registra no hist√≥rico
                this.gameHistory.actions.push({
                    type: action.type,
                    timestamp: Date.now(),
                    action: action.id,
                    state: 'government'
                });

                this.calculateGovernmentMetrics();
                this.updateAI();
                this.updateUI();
                this.setupGovernmentActions();
                
                // Eventos contextuais mais frequentes no governo
                if (Math.random() < 0.4) {
                    this.triggerIntelligentEvent();
                }

                if (this.player.stats.months <= 0) {
                    this.endTerm();
                }
            }

            startGovernmentTimer() {
                this.timers.government = setInterval(() => {
                    if (this.gameState !== 'government') {
                        clearInterval(this.timers.government);
                        return;
                    }
                    
                    this.player.stats.months--;
                    
                    // Degrada√ß√£o natural mais inteligente
                    const degradationRate = this.aiSystem.adaptiveDifficulty;
                    ['economy', 'social', 'security', 'international', 'environment'].forEach(stat => {
                        const decay = Math.random() * 1.5 * degradationRate;
                        this.player.stats[stat] = Math.max(0, this.player.stats[stat] - decay);
                    });

                    this.calculateGovernmentMetrics();
                    this.updateUI();
                    
                    if (this.player.stats.months <= 0) {
                        this.endTerm();
                    }
                }, 3000);
            }

            calculateGovernmentMetrics() {
                const { economy, social, security, environment, democracy } = this.player.stats;
                const avgPerf = (economy + social + security + environment) / 4;
                
                // C√°lculo mais sofisticado da popularidade
                this.player.stats.popularity = Math.round(
                    avgPerf * 0.6 + 
                    democracy * 0.2 + 
                    this.player.stats.popularity * 0.2
                );

                // Risco de impeachment baseado em m√∫ltiplos fatores
                const democraticRisk = democracy < 50 ? (50 - democracy) * 2 : 0;
                const popularityRisk = this.player.stats.popularity < 40 ? (40 - this.player.stats.popularity) * 1.5 : 0;
                const economicRisk = economy < 30 ? (30 - economy) : 0;
                
                this.player.stats.impeachmentRisk = Math.min(100, democraticRisk + popularityRisk + economicRisk);

                if (this.player.stats.impeachmentRisk >= 75) {
                    this.triggerImpeachment();
                }
            }

            triggerImpeachment() {
                clearInterval(this.timers.government);
                this.gameHistory.performance.gameEnded = 'impeachment';
                this.showModal(
                    "‚öñÔ∏è PROCESSO DE IMPEACHMENT", 
                    "O Congresso Nacional aprovou seu impeachment por crime de responsabilidade. Seu mandato chegou ao fim prematuramente.", 
                    [
                        { text: "Exportar Relat√≥rio", callback: () => this.exportToPDF() },
                        { text: "Novo Jogo", callback: () => this.init() }
                    ]
                );
            }

            triggerIntelligentEvent() {
                const event = this.generateIntelligentEvent();
                if (event) {
                    this.showEventModal(event);
                }
            }

            showEventModal(event) {
                this.showModal(
                    event.title, 
                    `${event.description}\n\n"${event.philosophy || ''}"`, 
                    event.choices.map(choice => ({
                        text: choice.text,
                        callback: () => {
                            this.applyEffects(choice.effects);
                            this.gameHistory.events.push({
                                event: event.title,
                                choice: choice.text,
                                timestamp: Date.now()
                            });
                            this.updateUI();
                        }
                    }))
                );
            }

            endTerm() {
                clearInterval(this.timers.government);
                
                this.gameHistory.performance.finalPopularity = this.player.stats.popularity;
                this.gameHistory.performance.completedTerms = this.player.term;
                
                if (this.player.term >= this.player.maxTerms) {
                    this.gameHistory.performance.gameEnded = 'completed_max_terms';
                    this.showModal(
                        "üèÜ CARREIRA PRESIDENCIAL COMPLETA", 
                        "Voc√™ completou o m√°ximo de mandatos constitucionais. Seu legado pol√≠tico est√° gravado na hist√≥ria do Brasil.", 
                        [
                            { text: "Ver Relat√≥rio Completo", callback: () => this.exportToPDF() },
                            { text: "Nova Simula√ß√£o", callback: () => this.init() }
                        ]
                    );
                } else if (this.player.stats.popularity >= 55) {
                    this.showModal(
                        "üó≥Ô∏è OPORTUNIDADE DE REELEI√á√ÉO", 
                        `Sua aprova√ß√£o de ${Math.round(this.player.stats.popularity)}% permite buscar a reelei√ß√£o. Deseja concorrer novamente?`, 
                        [
                            { text: "Buscar Reelei√ß√£o", callback: () => this.startReelection() },
                            { text: "Retirar-se da Pol√≠tica", callback: () => this.showFinalResults() }
                        ]
                    );
                } else {
                    this.gameHistory.performance.gameEnded = 'low_popularity';
                    this.showModal(
                        "üìâ FIM DE MANDATO", 
                        `Com apenas ${Math.round(this.player.stats.popularity)}% de aprova√ß√£o, a reelei√ß√£o n√£o √© vi√°vel politicamente.`, 
                        [
                            { text: "Exportar Relat√≥rio", callback: () => this.exportToPDF() },
                            { text: "Novo Jogo", callback: () => this.init() }
                        ]
                    );
                }
            }

            startReelection() {
                this.player.term++;
                // Herda parte da performance anterior
                this.player.stats.days = 90;
                this.player.stats.funds = Math.max(30, Math.round(this.player.stats.popularity * 0.7));
                this.player.stats.support = Math.round(this.player.stats.popularity * 0.4);
                this.player.stats.approval = Math.round(this.player.stats.popularity * 0.8);
                this.player.stats.months = 48;
                
                this.transitionToState('campaign');
            }

            showFinalResults() {
                const govStats = ['economy', 'social', 'security', 'international', 'environment'];
                const avgPerf = govStats.reduce((sum, stat) => sum + this.player.stats[stat], 0) / govStats.length;
                
                let evaluation = "Problem√°tico üìâ";
                if (avgPerf >= 80) evaluation = "Exemplar üèÜ";
                else if (avgPerf >= 65) evaluation = "Muito Bom üåü";
                else if (avgPerf >= 50) evaluation = "Bom üëç";
                else if (avgPerf >= 35) evaluation = "Regular üòê";

                this.gameHistory.performance.finalEvaluation = evaluation;
                this.gameHistory.performance.avgPerformance = Math.round(avgPerf);

                this.showModal(
                    "üìä LEGADO PRESIDENCIAL", 
                    `<strong>Avalia√ß√£o Final: ${evaluation}</strong><br><br>
                     Performance M√©dia: ${Math.round(avgPerf)}%<br>
                     Mandatos Exercidos: ${this.player.term}<br>
                     Aprova√ß√£o Final: ${Math.round(this.player.stats.popularity)}%<br>
                     Tempo Total: ${this.formatPlayTime()}`, 
                    [
                        { text: "Exportar Relat√≥rio Completo", callback: () => this.exportToPDF() },
                        { text: "Nova Simula√ß√£o", callback: () => this.init() }
                    ]
                );
            }

            formatPlayTime() {
                const totalMs = Date.now() - this.player.startTime;
                const minutes = Math.floor(totalMs / 60000);
                const seconds = Math.floor((totalMs % 60000) / 1000);
                return `${minutes}m ${seconds}s`;
            }

            // === SISTEMA DE SALVAMENTO ===
            saveGame() {
                const saveData = {
                    player: this.player,
                    gameState: this.gameState,
                    gameHistory: this.gameHistory,
                    aiSystem: this.aiSystem,
                    saveTime: Date.now()
                };
                
                try {
                    localStorage.setItem('republicaDigital_save', JSON.stringify(saveData));
                    this.showNotification("Jogo salvo automaticamente! üíæ");
                } catch(e) {
                    console.error("Erro ao salvar:", e);
                }
            }

            loadGame() {
                try {
                    const savedData = localStorage.getItem('republicaDigital_save');
                    if (!savedData) {
                        this.showNotification("Nenhum jogo salvo encontrado!");
                        return;
                    }

                    const saveData = JSON.parse(savedData);
                    this.player = saveData.player;
                    this.gameState = saveData.gameState;
                    this.gameHistory = saveData.gameHistory || { actions: [], events: [], decisions: [], performance: {} };
                    this.aiSystem = saveData.aiSystem || this.aiSystem;

                    this.transitionToState(this.gameState);
                    this.showNotification("Jogo carregado com sucesso! üìÅ");
                } catch(e) {
                    console.error("Erro ao carregar:", e);
                    this.showNotification("Erro ao carregar jogo salvo!");
                }
            }

            autoSaveInterval() {
                setInterval(() => {
                    if (this.gameState !== 'setup') {
                        this.saveGame();
                    }
                }, 30000); // Auto-save a cada 30 segundos
            }

            // === SISTEMA DE EXPORTA√á√ÉO PDF ===
            exportToPDF() {
                if (typeof window.jsPDF === 'undefined') {
                    this.showNotification("Erro: Biblioteca PDF n√£o carregada!");
                    return;
                }

                const { jsPDF } = window.jsPDF;
                const doc = new jsPDF();
                
                // Configura√ß√£o de cores e fontes
                const primaryColor = [44, 62, 80];
                const accentColor = [52, 152, 219];
                
                let yPosition = 20;
                
                // CABE√áALHO
                doc.setFontSize(24);
                doc.setTextColor(...primaryColor);
                doc.text('REP√öBLICA DIGITAL', 105, yPosition, { align: 'center' });
                
                yPosition += 10;
                doc.setFontSize(16);
                doc.setTextColor(...accentColor);
                doc.text('Relat√≥rio de Performance Pol√≠tica', 105, yPosition, { align: 'center' });
                
                yPosition += 20;
                doc.setDrawColor(...primaryColor);
                doc.line(20, yPosition, 190, yPosition);
                
                // INFORMA√á√ïES DO JOGADOR
                yPosition += 15;
                doc.setFontSize(14);
                doc.setTextColor(...primaryColor);
                doc.text('PERFIL DO CANDIDATO', 20, yPosition);
                
                yPosition += 10;
                doc.setFontSize(12);
                doc.text(`Nome: ${this.player.name}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Orienta√ß√£o Pol√≠tica: ${this.player.ideology.charAt(0).toUpperCase() + this.player.ideology.slice(1)}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Mandatos Exercidos: ${this.player.term}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Tempo de Jogo: ${this.formatPlayTime()}`, 20, yPosition);
                
                // ESTAT√çSTICAS FINAIS
                yPosition += 20;
                doc.setFontSize(14);
                doc.setTextColor(...primaryColor);
                doc.text('ESTAT√çSTICAS FINAIS', 20, yPosition);
                
                yPosition += 10;
                doc.setFontSize(12);
                
                if (this.gameState === 'government' || this.gameHistory.performance.electionScore) {
                    doc.text(`Score Eleitoral: ${this.gameHistory.performance.electionScore || 'N/A'}%`, 20, yPosition);
                    yPosition += 6;
                }
                
                const govStats = ['economy', 'social', 'security', 'international', 'environment', 'democracy'];
                govStats.forEach(stat => {
                    const value = Math.round(this.player.stats[stat]);
                    const label = this.getStatName(stat);
                    doc.text(`${label}: ${value}%`, 20, yPosition);
                    yPosition += 6;
                });
                
                doc.text(`Aprova√ß√£o Popular Final: ${Math.round(this.player.stats.popularity)}%`, 20, yPosition);
                yPosition += 6;
                doc.text(`Risco de Impeachment: ${Math.round(this.player.stats.impeachmentRisk)}%`, 20, yPosition);
                
                // AN√ÅLISE DE PERFORMANCE
                yPosition += 15;
                doc.setFontSize(14);
                doc.setTextColor(...primaryColor);
                doc.text('AN√ÅLISE DE PERFORMANCE', 20, yPosition);
                
                yPosition += 10;
                doc.setFontSize(12);
                const avgPerf = govStats.reduce((sum, stat) => sum + this.player.stats[stat], 0) / govStats.length;
                doc.text(`Performance M√©dia Governamental: ${Math.round(avgPerf)}%`, 20, yPosition);
                
                yPosition += 6;
                let legacyText = "Legado Pol√≠tico: ";
                if (avgPerf >= 80) legacyText += "Presidente Exemplar";
                else if (avgPerf >= 65) legacyText += "Presidente Muito Bom";
                else if (avgPerf >= 50) legacyText += "Presidente Competente";
                else if (avgPerf >= 35) legacyText += "Presidente Regular";
                else legacyText += "Presidente Problem√°tico";
                
                doc.text(legacyText, 20, yPosition);
                
                // HIST√ìRICO DE A√á√ïES
                if (this.gameHistory.actions.length > 0) {
                    yPosition += 15;
                    doc.setFontSize(14);
                    doc.text('PRINCIPAIS A√á√ïES EXECUTADAS', 20, yPosition);
                    
                    yPosition += 10;
                    doc.setFontSize(10);
                    const recentActions = this.gameHistory.actions.slice(-10);
                    recentActions.forEach(action => {
                        if (yPosition > 250) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        const date = new Date(action.timestamp).toLocaleString('pt-BR');
                        doc.text(`${date} - ${action.action} (${action.state})`, 20, yPosition);
                        yPosition += 5;
                    });
                }
                
                // EVENTOS IMPORTANTES
                if (this.gameHistory.events.length > 0) {
                    yPosition += 10;
                    doc.setFontSize(14);
                    doc.text('EVENTOS IMPORTANTES', 20, yPosition);
                    
                    yPosition += 10;
                    doc.setFontSize(10);
                    this.gameHistory.events.forEach(event => {
                        if (yPosition > 250) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        const date = new Date(event.timestamp).toLocaleString('pt-BR');
                        doc.text(`${date} - ${event.event}`, 20, yPosition);
                        yPosition += 4;
                        doc.text(`Decis√£o: ${event.choice}`, 25, yPosition);
                        yPosition += 8;
                    });
                }
                
                // RODAP√â
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text('Gerado por Rep√∫blica Digital - Simulador Pol√≠tico Avan√ßado', 105, 285, { align: 'center' });
                doc.text(`Data: ${new Date().toLocaleString('pt-BR')}`, 105, 290, { align: 'center' });
                
                // DOWNLOAD
                const fileName = `RelatorioPresidencial_${this.player.name.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                this.showNotification("Relat√≥rio PDF exportado com sucesso! üìÑ");
            }

            // === FUN√á√ïES DE UI E RENDERIZA√á√ÉO ===
            showScreen(screenId) {
                this.dom.screens.forEach(s => s.classList.remove('active'));
                const screen = document.getElementById(screenId);
                if (screen) screen.classList.add('active');
            }

            renderActions(containerId, actions, callback) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = '';
                
                actions.forEach(action => {
                    const canAfford = this.canAffordAction(action.costs);
                    const actionDiv = document.createElement('div');
                    actionDiv.className = `action-card ${!canAfford ? 'disabled' : ''}`;
                    
                    if (canAfford) {
                        actionDiv.addEventListener('click', () => callback(action));
                    }

                    const costsText = Object.entries(action.costs)
                        .map(([k, v]) => `${this.getResourceSymbol(k)}${v}`)
                        .join(' ');
                    
                    const effectsHTML = Object.entries(action.effects)
                        .map(([k, v]) => `<span class="effect ${v > 0 ? 'positive' : 'negative'}">${v > 0 ? '+' : ''}${v} ${this.getStatName(k)}</span>`)
                        .join('');

                    actionDiv.innerHTML = `
                        <div class="action-title">
                            <span>${action.title}</span>
                            <span class="action-cost">${costsText}</span>
                        </div>
                        <div class="action-description">${action.description}</div>
                        <div class="action-effects">${effectsHTML}</div>
                    `;
                    
                    container.appendChild(actionDiv);
                });
            }

            showModal(title, content, choices = []) {
                if (!this.dom.modal) return;
                
                this.dom.modalTitle.textContent = title;
                this.dom.modalBody.innerHTML = content.replace(/\n/g, '<br>');
                this.dom.modalChoices.innerHTML = '';

                if (choices.length === 0) {
                    choices.push({ text: "OK", callback: () => {} });
                }

                choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = choice.text;
                    btn.onclick = () => {
                        this.dom.modal.classList.remove('active');
                        if (choice.callback) choice.callback();
                    };
                    this.dom.modalChoices.appendChild(btn);
                });
                
                this.dom.modal.classList.add('active');
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }

            updateUI() {
                const { stats } = this.player;
                const safeSet = (id, val) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = val;
                };

                // Header
                if (this.dom.termDisplay) {
                    this.dom.termDisplay.textContent = this.gameState === 'government' ? `${this.player.term}¬∫ Mandato` : '';
                }

                // Campaign stats
                safeSet('days-left', Math.max(0, stats.days));
                safeSet('funds', Math.max(0, stats.funds));
                safeSet('support', Math.max(0, Math.round(stats.support)));

                const campaignStatsEl = document.getElementById('campaign-stats');
                if (campaignStatsEl) {
                    campaignStatsEl.innerHTML = `
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.approval)}</div><div class="stat-label">Aprova√ß√£o</div></div>
                        <div class="stat-item"><div class="stat-value">${stats.coalitions}</div><div class="stat-label">Coliga√ß√µes</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.mediaPresence)}</div><div class="stat-label">M√≠dia</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.debateScore)}</div><div class="stat-label">Debates</div></div>
                    `;
                }

                // Government stats
                safeSet('months-left', Math.max(0, stats.months));
                
                const governmentStatsEl = document.getElementById('government-stats');
                if (governmentStatsEl) {
                    governmentStatsEl.innerHTML = `
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.economy)}</div><div class="stat-label">Economia</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.social)}</div><div class="stat-label">Social</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.security)}</div><div class="stat-label">Seguran√ßa</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.international)}</div><div class="stat-label">Internacional</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.environment)}</div><div class="stat-label">Ambiente</div></div>
                        <div class="stat-item"><div class="stat-value">${Math.round(stats.democracy)}</div><div class="stat-label">Democracia</div></div>
                    `;
                }
                
                // Progress bars
                safeSet('popularity-percent', `${Math.round(stats.popularity)}%`);
                const popularityBar = document.getElementById('popularity-bar');
                if (popularityBar) {
                    popularityBar.style.width = `${Math.max(0, Math.min(100, stats.popularity))}%`;
                }
                
                safeSet('impeachment-percent', `${Math.round(stats.impeachmentRisk)}%`);
                const impeachmentBar = document.getElementById('impeachment-bar');
                if (impeachmentBar) {
                    impeachmentBar.style.width = `${Math.max(0, Math.min(100, stats.impeachmentRisk))}%`;
                }
            }

            // === FUN√á√ïES AUXILIARES ===
            applyCosts(costs) {
                Object.entries(costs).forEach(([resource, cost]) => {
                    this.player.stats[resource] = Math.max(0, this.player.stats[resource] - cost);
                });
            }

            applyEffects(effects) {
                Object.entries(effects).forEach(([stat, value]) => {
                    if (this.player.stats.hasOwnProperty(stat)) {
                        this.player.stats[stat] = Math.max(0, Math.min(100, this.player.stats[stat] + value));
                    }
                });
            }

            canAffordAction(costs) {
                return Object.entries(costs).every(([resource, cost]) => 
                    this.player.stats[resource] >= cost
                );
            }

            getResourceSymbol(resource) {
                const symbols = { funds: 'üí∞', days: '‚è∞', months: 'üóìÔ∏è' };
                return symbols[resource] || '';
            }

            getStatName(stat) {
                const names = {
                    support: 'Apoio', approval: 'Aprova√ß√£o', mediaPresence: 'M√≠dia',
                    debateScore: 'Debate', coalitions: 'Coliga√ß√µes', economy: 'Economia',
                    social: 'Social', security: 'Seguran√ßa', international: 'Internacional',
                    environment: 'Ambiente', democracy: 'Democracia', popularity: 'Popularidade'
                };
                return names[stat] || stat;
            }
        }

        // Inicializa√ß√£o global
        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new RepublicaDigital();
        });
    </script>
</body>
</html>
